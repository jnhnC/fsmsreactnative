

import React, { useEffect, useState } from 'react';
import { WebView } from 'react-native-webview'
import 'react-native-gesture-handler';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import QrScan from './QrScan'

import QRCodeScanner from 'react-native-qrcode-scanner';
import {
  AppRegistry,
  StyleSheet,
  Text,
  TouchableOpacity,
  Linking,
  View
} from 'react-native';

const Stack = createStackNavigator();

const App = () => {

  const [visible, setVisible] = useState(false);
  const [webview, setWebview] = useState(null);
  const [result, setResult] = useState('tset');

  //화면 전환 호출
  const handleOnMessage = ({ nativeEvent: { data } }) => {
    alert("리액트 호출");

    // this.webview.postMessage(data);
     setVisible(true);
    // webview.current.injectedJavaScript(data);

  };

  onLoadWebview = () =>{
    
    this.webref.postMessage(JSON.stringify(result));
  }

  const onSuccess = e => {
    setResult(e.data);
    setVisible(false);
  };

  if (!visible) {
    return (
      <WebView
        ref={(r) => (this.webref = r)}
        source={{ uri: 'http://192.168.30.231:8080' }}
        onMessage={handleOnMessage}
        javaScriptEnabled={true}
        onLode={this.onLoadWebview}
        // injectedJavaScript={'(function(){return "Send me back!"}());'}
        // onNavigationStateChange={this.handleWebViewNavigationStateChange}
      />
    );
  } else {

    return (

      <View style={{ width: '100%', height: '100%' }}>

        <View style={{ flex: 1, alignItems: 'center', justifyContent: 'center' }}>
          <QRCodeScanner
            onRead={onSuccess}
            // flashMode={RNCamera.Constants.FlashMode.torch}
            topContent={
              <Text style={styles.centerText}>
                Go to{' '}
                <Text style={styles.textBold}>wikipedia.org/wiki/QR_code</Text> on
            your computer and scan the QR code.
          </Text>
            }
            bottomContent={
              <TouchableOpacity style={styles.buttonTouchable}>
                <Text name="result" style={styles.buttonText}>{result}</Text>
              </TouchableOpacity>
            }
          />
        </View>

      </View>
    );
  }
};


const styles = StyleSheet.create({
  centerText: {
    flex: 1,
    fontSize: 18,
    padding: 32,
    color: '#777'
  },
  textBold: {
    fontWeight: '500',
    color: '#000'
  },
  buttonText: {
    fontSize: 21,
    color: 'rgb(0,122,255)'
  },
  buttonTouchable: {
    padding: 16
  }
});

export default App;